<html>

<head>
    <script>
        function startUp() {
            var loggedIn = localStorage.getItem('localStorage2')
            if (loggedIn == "1") {
                window.location = "index.html"
            } else {

            }
        }
        function createUserLocal(username, password) {
            // fetch users from storage
            // add username/password to users
            // json strigify users
            // save json back to storage
            var users = JSON.parse(localStorage.getItem("localStorage3")) || []
            users[username] = password
            localStorage.setItem('localStorage3', JSON.stringify(users))
            // localStorage.setItem('localStorage3', JSON.stringify(users))
        }
        function getUsersRemote() {
            return fetch("https://haydenivins.s3-ap-southeast-2.amazonaws.com/jswebchat.json")
                .then(response => response.json())
        }
        function createUserRemote(username, password) {
            getUsersRemote()
                .then(users => {
                    users[username] = { password: password, username: username }
                    return fetch("https://haydenivins.s3-ap-southeast-2.amazonaws.com/jswebchat.json",
                        { method: "PUT", body: JSON.stringify(users) })
                })
                .then(response => {
                    console.log('created user!')
                })
        }
        // add user to users
        function deleteUserRemote(){
            getUsersRemote()
            .then (users => {
                    delete users[username] 
                    return fetch("https://haydenivins.s3-ap-southeast-2.amazonaws.com/jswebchat.json",
                        { method: "PUT", body: JSON.stringify(users) })
                })
                .then(response => {
                    console.log('deleted user')
                })
        }
        function signUp() {
            var username = document.querySelector("#username").value
            var password = document.querySelector("#password").value
            var status = document.querySelector("#status")
            createUserRemote(username, password)
            status.innerHTML = "sign up successful"
            setTimeout(redirect, 1000)
        }
        function redirect() {
            var loggedIn = "1"
            localStorage.setItem("localStorage2", loggedIn)
            window.location = "index.html"
        }
    </script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css">
</head>

<body onLoad="startUp()">
    <div class="hero-body">
        <div class="container has-text-centered">
            <p>Sign up, like login, is in beta. It will not work properly until later</p>
            <p>username:<input id="username" type=text></p>
            <p>password:<input id="password" type=text></p>
            <p><button onClick="signUp()">Sign Up</button></p>
            <p>
                <div id="status"></div>
            </p>
        </div>
    </div>
</body>

</html>