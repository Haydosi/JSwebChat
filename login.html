<html>

<head>
    <script>
        var users = {}
        // var storedUsername = "admin"
        // var storedPassword = "pass"
        // var users = {
        //     admin: "pass",
        //     beta: "tester",
        //     personal: "yeet"
        // }
        function getUsersLocal() {
            return Promise.resolve(JSON.parse(localStorage.getItem('localStorage3')) || [])
        }
        function getUsersRemote() {
            return fetch("https://haydenivins.s3-ap-southeast-2.amazonaws.com/jswebchat.json")
                .then(response => response.json())
        }
        function startUp() {
            var loggedIn = localStorage.getItem('localStorage2')
            if (loggedIn == "1") {
                window.location = "index.html"
            } else {
                getUsersRemote().then(response => {
                    users = response
                });
            }
        }
        function login() {
            var username = document.querySelector("#username").value
            var password = document.querySelector("#password").value
            var status = document.querySelector("#status")
            console.log('users', users)
            if (users[username].password == password) {
                status.innerHTML = "login successful"
                console.log("succeed")
                setTimeout(redirect, 1000)
            } else {
                status.innerHTML = "login failed"
                console.log("fail")
            }
            // if (username == storedUsername) {
            //     if (password == storedPassword) {
            // status.innerHTML = "login successful"
            // console.log("succeed")
            // setTimeout(redirect, 1000)
            //     } else {
            //         status.innerHTML = "login failed"
            //         console.log("fail")
            //     }
            // } else {
            //     status.innerHTML = "login failed"
            //     console.log("fail")
            // }
        }
        function redirect() {
            var loggedIn = "1"
            localStorage.setItem("localStorage2", loggedIn)
            window.location = "index.html"
        }
        function redirect2() {
            window.location = "signUp.html"
        }
        function viewPassword() {
            console.log("ran")
            var passwordInput = document.querySelector("#password");
            var eyeIcon = document.querySelector("#eye");
            if (passwordInput.type == "password") {
                passwordInput.type = "text";
                eyeIcon.classList.remove('mdi-eye');
                eyeIcon.classList.add('mdi-eye-off');
            } else {
                passwordInput.type = "password";
                eyeIcon.classList.remove('mdi-eye-off');
                eyeIcon.classList.add('mdi-eye');
            }
        }
    </script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.materialdesignicons.com/4.4.95/css/materialdesignicons.min.css">
</head>

<body onLoad="startUp()">
    <section class="hero is-fullheight">
        <div class="hero-body">
            <div class="container has-text-centered">
                <!-- <p>Please Login</p>
                <p>username:<input id="username" type=text></p>
                <p>password:<input id="password" type=text></p>
                <p><button onClick="login()">LOGIN</button></p>
                <div id="status"></div>
                <p>Don't have an account?</p>
                <p><button onClick="redirect2()">Sign Up</button></p> -->
                <div style="width: 400px" class="container has-text-centered">
                    <div class="field">
                        <p class="control has-icons-left has-icons-right">
                            <input class="input" type="username" placeholder="Username" id="username">
                            <span class="icon is-small is-left">
                                <i class="mdi mdi-account"></i>
                            </span>
                            <span class="icon is-small is-right">
                                <i class="fas fa-check"></i>
                            </span>
                        </p>
                    </div>
                    <div class="field">
                        <p class="control has-icons-left has-icons-right">
                            <input class="input" type="password" placeholder="Password" id="password">
                            <span class="icon is-small is-left">
                                <i class="mdi mdi-lock"></i>
                            </span>
                            <span class="icon is-small is-right">
                                <i class="mdi mdi-eye" onClick="viewPassword()" style="pointer-events: initial" id="eye"></i>
                            </span>
                        </p>
                    </div>
                    <div class="field">
                        <p class="control has-text-centered">
                            <button class="button is-success" onClick="login()">
                                Login
                            </button>
                            <button class="button is-success" onClick="redirect2()">
                                Or sign up here
                            </button>
                        </p>
                    </div>
                    <div id="status"></div>
                </div>
            </div>
        </div>
    </section>
</body>

</html>